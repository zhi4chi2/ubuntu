# 为什么要学习 vi

nano 并不总是可用，而 vi 总是可用（ POSIX 要求）。

# vi 背景

大部分 Linux 发行版配备的是 vim(Vi Improved)。通常 vi 硬链接（或别名）到 vim

# 启动和退出 vi

- :q - 退出
- :q! - 强制退出


如果不能确定 vi 所处的状态，按 Esc 两次返回初始状态。

# 编辑模式

每行开始的 ~ 表示该行没有内容。


- 命令模式 - 每个按键都是命令
- 插入模式

- 增强模式
- 兼容模式 - vim 用近似 vi 的常规模式运行

进入增强模式
- 运行 vim 而不是 vi
- 执行 `echo "set nocp" >> ~/.vimrc

按 i/I 进入插入模式，如果是增强模式，则 vi 底部会出现 -- INSERT --

# 保存工作

在命令模式下按 : 也叫输入 ex 命令

- :w - 保存

保存后会在 vi 底部出现

有些 Linux 发行版只安装 vim 的最小版本，需要安装完全版 vim

# 移动光标

* h
* j
* k
* l
* 0 - 行开头
* ^ - 本行第一个非空字符
* $ - 行尾
* w - 下一个单词或标点
* W - 下一个单词
* b - 上一个单词或标点
* B - 上一个单词
* Ctrl+F - 下一页
* Ctrl+B - 上一页
* n+G - 第 n 行，例如 1G 到第一行
* G - 最后一行

其它命令（比如 j ）也可以前面加数字，就像 g 一样。


# 基本编辑

* u - 撤销， vi 只能撤销上一次操作， vim 可以向上撤销多次操作

## 添加文本

- a - 在行尾添加

## 插入一行

- o - 在当前行上方插入一行
- O - 在当前行下方插入一行

## 删除文本

- x - 删除光标处字符，前面可以加数字表示删除几个字符，例如 3x
- d - 可以加光标移动命令作为后缀，例如 dl 删除右边字符
  - dd - 删除当前行， 5dd 表示删除 5 行
  - dw - 当前词
  - d$ - 从当前字符到行尾
  - d0 - 从当前字符到行首
  - d^ - 从当前字符到行第一个非空字符
  - dG - 当前行到文件尾， d20G 从当前行到文件第 20 行

## 剪切、复制和粘贴

d 命令其实是剪切。

- p - 粘贴到光标之后
- P - 粘贴到光标之前
- y - 复制
  - yy - 复制当前行， 5yy 表示复制 5 行
  - yw - 当前词
  - y$ - 从当前字符到行尾
  - y0 - 从当前字符到行首
  - y^ - 从当前字符到行第一个非空字符
  - yG - 当前行到文件尾， y20G 从当前行到文件第 20 行

## 合并行

- J - 合并行

# 查找和替换

- f - 行内搜索，例如 fa 搜索下一个 a 字符。首次搜索后按 ; 查找下一个
- / - 搜索整个文件。首次搜索后按 n 查找下一个

## 全局搜索和替换

例如
```bash
:%s/Line/line/g
```

其中
- % - 确定搜索范围。 % 表示整个文档。默认只是当前行。还可以指定为 1,$ 或者 1,n 表示从第一行到第 n 行
- s - 指定操作（替换）
- /Line/line - 搜索和替换的文本
- g - 全部替换。默认每一行只替换搜索到的第一个

其它
- c - 表示每次替换都要确认

回答
- y
- n
- a - 执行所有替换
- q - 停止替换
- l - last, 执行替换并结束替换
- Ctrl+E, Ctrl+Y - 向下向上滚动查看替换处的上下文

# 编辑多个文件

```bash
vi file1 file2 file3
```

## 切换文件

- :n - 切换到下一个文件
- :N - 切换到上一个文件
- :buffers - 查看正在编辑的文件列表
- :buffer + n - 切换到另一个文件，例如 `:buffer 2`

## 载入更多文件

- :e + 文件名 - 载入新文件

使用 :ez 载入的文件不响应 :n/:N 只能用 :buffer 切换。


## 文件之间的内容复制


## 插入整个文件

- :r + 文件名 - 将文件内容插入到光标位置之前

# 保存工作

- :w
- :w + 文件名 - 另存为。但是保存之后编辑的仍然是原文件！而不是另存为之后的文件！
- zz - 保存并退出 vi

